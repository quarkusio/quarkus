<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="1" author="loic">
      <preConditions onFail="WARN">
        <ext:collectionExists name="test"/>
      </preConditions>

        <ext:createCollection collectionName="Fruit"/>

        <ext:createIndex collectionName="Fruit">
            <ext:keys>{color: 1}</ext:keys>
            <ext:options>{name: "colorIdx"}</ext:options>
        </ext:createIndex>

        <ext:insertOne collectionName="Fruit">
            <ext:document>{"name":"orange", "color": "orange"}</ext:document>
        </ext:insertOne>

    </changeSet>

  <changeSet id="2" author="RK">
    <comment>use runCommand to execute arbitrary mongo commands.</comment>
    <ext:runCommand>
      <ext:command>
        {
        update: "fruit",
        updates: [
        {
        q: {name: null},
        u: {$set: {name: "unknown"}},
        multi: true
        }
        ]
        }
      </ext:command>
    </ext:runCommand>
  </changeSet>

</databaseChangeLog>
